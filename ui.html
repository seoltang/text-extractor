<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Inter:opsz,wght@14..32,100..900&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary: #00aeff;
        --primary-50: #e5f6fe;
        --primary-100: #c4ecfe;
        --primary-200: #a1e1ff;
        --primary-600: #008dcf;
        --primary-700: #006796;
        --primary-800: #004261;
        --primary-shadow: rgba(0, 141, 207, 0.2);

        --red: #dc2626;

        /* Base colors */
        --white: #fff;
        --black: #000;

        /* Gray scale */
        --gray-50: #fafafa;
        --gray-100: #f5f5f5;
        --gray-200: #e5e5e5;
        --gray-300: #d4d4d4;
        --gray-400: #a3a3a3;
        --gray-500: #737373;
        --gray-600: #525252;
        --gray-700: #404040;
        --gray-800: #262626;
        --gray-900: #171717;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 20px;
        background-color: var(--white);
        color: var(--gray-900);
        font-family: 'Inter', sans-serif;
        letter-spacing: -0.01em;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      ::selection {
        background-color: var(--primary-100);
      }

      :focus-visible {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--white), 0 0 0 4px var(--primary-shadow);
      }

      .container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        flex: 1;
        min-height: 0;
      }

      h1 {
        display: none;
        align-items: center;
        column-gap: 0.5rem;
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
      }

      label.checkbox {
        position: relative;
        align-self: flex-start;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.875rem;
        user-select: none;
      }

      label.checkbox input[type='checkbox'] {
        appearance: none;
        -webkit-appearance: none;
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid #ccc;
        border-radius: 6px;
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      label.checkbox input[type='checkbox']:checked {
        border-color: var(--primary);
        background-color: var(--primary);
      }

      label.checkbox input[type='checkbox']::after {
        content: '';
        display: none;
      }

      label.checkbox input[type='checkbox']:checked::after {
        content: '';
        display: block;
        width: 1rem;
        height: 1rem;
        background-image: url("data:image/svg+xml,%3csvg viewBox='6 8 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='m9 12 2 2 4-4' stroke='white' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      .flex {
        display: flex;
        gap: 1rem;
        flex: 1;
        min-height: 0;
      }

      .field-group {
        flex: 1 1 0;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        position: relative;
        min-width: 0;
        min-height: 0;
      }

      .field-group.hidden {
        display: none;
      }

      .field-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
      }

      .field-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        min-width: 0;
      }

      .field-label-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .field-label.readonly::after {
        content: 'Auto';
        font-size: 0.6875rem;
        font-weight: normal;
        color: var(--gray-600);
        background-color: transparent;
        border: 1px solid var(--gray-300);
        padding: 0.125rem 0.375rem;
        border-radius: 1rem;
        white-space: nowrap;
        letter-spacing: -0.01em;
      }

      textarea {
        height: 100%;
        min-height: 300px;
        padding: 0.75rem;
        font-size: 0.875rem;
        font-family: 'Fira Code', monospace;
        white-space: pre;
        border-radius: 0.625rem;
        border: 1px solid var(--gray-200);
        background-color: var(--white);
        resize: none;
        transition: all 0.15s ease;
        flex: 1;
      }

      textarea::placeholder {
        color: var(--gray-500);
      }

      textarea:hover {
        border-color: var(--gray-400);
      }

      textarea:focus {
        outline: none;
      }

      textarea:focus-visible {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--white), 0 0 0 4px var(--primary-shadow);
      }

      .variable-name-container {
        height: 100%;
        min-height: 300px;
        padding: 0.75rem;
        font-size: 0.875rem;
        font-family: 'Fira Code', monospace;
        border-radius: 0.625rem;
        background-color: var(--gray-50);
        border: 1px solid var(--gray-200);
        overflow: auto;
        white-space: pre;
        color: var(--gray-700);
        cursor: text;
        user-select: text;
        position: relative;
        transition: all 0.15s ease;
        flex: 1;
      }

      .variable-name-container:hover {
        border-color: var(--gray-400);
      }

      .variable-name-container:empty::before {
        content: 'Select a layer';
        color: var(--gray-500);
        position: absolute;
        top: 0.75rem;
        left: 0.75rem;
        font-size: 0.875rem;
        white-space: nowrap;
        pointer-events: none;
      }

      .button {
        padding: 0.375rem 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        background-color: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 0.375rem;
        color: var(--primary);
        cursor: pointer;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .button.sm {
        padding: 0.25rem 0.375rem;
        font-size: 0.75rem;
      }

      .button svg {
        width: 0.875rem;
        height: 0.875rem;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
      }

      .button::before {
        display: none;
      }

      .button:hover {
        background-color: var(--primary-50);
        border-color: var(--gray-200);
      }

      .button:active {
        background-color: var(--primary-100);
        border-color: var(--gray-200);
      }

      .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--gray-900);
        color: var(--white);
        padding: 0.625rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 999;
      }

      .toast.show {
        opacity: 1;
      }

      .delimiter-section {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--gray-200);
        flex-shrink: 0;
      }

      .delimiter-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.375rem;
        transition: background-color 0.15s ease;
      }

      .delimiter-header:hover {
        background-color: var(--gray-50);
      }

      .delimiter-title {
        margin: 0;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--gray-800);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .delimiter-toggle-icon {
        transition: transform 0.2s ease;
        color: var(--gray-600);
      }

      .delimiter-header.expanded .delimiter-toggle-icon {
        transform: rotate(180deg);
      }

      .delimiter-content {
        max-height: 0;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .delimiter-content.expanded {
        max-height: 11rem;
      }

      .delimiter-sets {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 10.5rem;
      }

      .delimiter-set {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem;
        background-color: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 0.375rem;
      }

      .delimiter-inputs {
        display: flex;
        gap: 0.5rem;
        flex: 1;
      }

      .delimiter-input {
        flex: 1;
        padding: 0.375rem 0.5rem;
        font-size: 0.75rem;
        border: 1px solid var(--gray-300);
        border-radius: 0.375rem;
        background-color: var(--white);
      }

      .delimiter-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--white), 0 0 0 4px var(--primary-shadow);
      }

      .shortcut-modifier {
        margin-inline-start: 0.25rem;
        flex-shrink: 0;
      }

      .shortcut-input {
        width: 120px;
        padding: 0.375rem 0.5rem;
        font-size: 0.75rem;
        border: 1px solid var(--gray-300);
        border-radius: 0.375rem;
        background-color: var(--white);
        text-align: center;
        cursor: pointer;
      }

      .shortcut-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--white), 0 0 0 4px var(--primary-shadow);
      }

      .delimiter-actions {
        display: flex;
        gap: 0.25rem;
      }

      .delimiter-button {
        padding: 0.375rem;
        border: none;
        background: none;
        cursor: pointer;
        color: var(--gray-600);
        border-radius: 0.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .delimiter-button:hover {
        background-color: var(--gray-100);
        color: var(--gray-900);
      }

      .delimiter-button.delete:hover {
        color: var(--red);
      }

      .delimiter-buttons {
        display: none;
        gap: 0.5rem;
        padding: 0.5rem;
        background-color: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 0.625rem;
        flex-shrink: 0;
      }

      h2 {
        margin: 0;
        font-size: 0.875rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .tooltip-icon {
        display: inline-flex;
        align-items: center;
        color: var(--gray-600);
        cursor: help;
        position: relative;
      }
      .tooltip-icon:hover .custom-tooltip,
      .tooltip-icon:focus .custom-tooltip {
        display: block;
      }
      .custom-tooltip {
        display: none;
        position: absolute;
        inset-inline-start: 120%;
        inset-block-end: 0%;
        background: var(--gray-900);
        color: var(--white);
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 300;
        line-height: 1.5;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        width: 18rem;
      }

      footer {
        text-align: center;
        font-size: 0.625rem;
        font-weight: 300;
        color: var(--gray-400);
        margin-top: 0.5rem;
        padding-top: 0.5rem;
        border-top: 1px solid var(--gray-200);
      }

      footer strong {
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Text Extractor</h1>

      <label class="checkbox">
        <input type="checkbox" id="autoVariableName" checked />
        Auto-generate variable name
      </label>

      <div class="flex">
        <section class="field-group">
          <div class="field-header">
            <label class="field-label" for="textArea">
              <h2 class="field-label-text">Text</h2>
            </label>
            <button class="button sm copy-button" data-target="textArea">
              <svg viewBox="0 0 24 24">
                <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                <path
                  d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                />
              </svg>
              Copy
            </button>
          </div>
          <textarea id="textArea" placeholder="Select a layer"></textarea>
        </section>
        <section class="field-group variable-name">
          <div class="field-header">
            <label class="field-label readonly">
              <h2 class="field-label-text">Variable Name</h2>
            </label>
            <button class="button sm copy-button" data-target="variableNameContainer">
              <svg viewBox="0 0 24 24">
                <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                <path
                  d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                />
              </svg>
              Copy
            </button>
          </div>
          <div id="variableNameContainer" class="variable-name-container"></div>
        </section>
      </div>

      <div class="delimiter-buttons" id="delimiterButtons"></div>

      <div class="delimiter-section">
        <div class="delimiter-header" id="delimiterHeader">
          <h2 class="delimiter-title">
            <svg class="delimiter-toggle-icon" viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M6 9l6 6 6-6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
            </svg>
            Delimiter Sets
            <span class="tooltip-icon" tabindex="0">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M8 1.33334C4.32 1.33334 1.33333 4.32001 1.33333 8.00001C1.33333 11.68 4.32 14.6667 8 14.6667C11.68 14.6667 14.6667 11.68 14.6667 8.00001C14.6667 4.32001 11.68 1.33334 8 1.33334ZM8.66667 11.3333H7.33333V7.33334H8.66667V11.3333ZM8.66667 6.00001H7.33333V4.66668H8.66667V6.00001Z"
                  fill="currentColor"
                />
              </svg>
              <span class="custom-tooltip">
                Set custom markers and shortcuts to wrap text. Select text in the textarea and press
                <span id="shortcutKey">⌘/Ctrl + key</span> or click the button above.
              </span>
            </span>
          </h2>
          <button class="button sm" id="addDelimiterButton">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M12 4v16m8-8H4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                fill="none"
              />
            </svg>
            Add Set
          </button>
        </div>
        <div class="delimiter-content" id="delimiterContent">
          <div class="delimiter-sets" id="delimiterSets"></div>
        </div>
      </div>
    </div>

    <footer>Developed by <strong>Cheshire</strong> · Designed by <strong>Kate</strong></footer>

    <div id="toast" class="toast"></div>

    <script>
      // ===== 상수 및 전역 변수 =====
      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
      const modifierLabel = isMac ? '⌘' : 'Ctrl';
      const DELIMITER_SET_MAX_COUNT = 3;

      // ===== DOM 요소 =====
      const elements = {
        autoVariableName: document.getElementById('autoVariableName'),
        variableNameContainer: document.getElementById('variableNameContainer'),
        textArea: document.getElementById('textArea'),
        toast: document.getElementById('toast'),
        addDelimiterButton: document.getElementById('addDelimiterButton'),
        delimiterSets: document.getElementById('delimiterSets'),
        delimiterButtons: document.getElementById('delimiterButtons'),
        shortcutKey: document.getElementById('shortcutKey'),
        delimiterHeader: document.getElementById('delimiterHeader'),
        delimiterContent: document.getElementById('delimiterContent'),
      };

      // ===== Variable Name 관련 기능 =====
      const createVariableNameGenerator = () => {
        const toCamelCase = (text) => {
          return text
            .toLowerCase()
            .replace(/[^a-zA-Z0-9 ]/g, '')
            .split(/\s+/)
            .map((word, i) => (i === 0 ? word : word.charAt(0).toUpperCase() + word.slice(1)))
            .join('');
        };

        const updateVariableNames = () => {
          if (!elements.autoVariableName.checked) {
            return;
          }
          const lines = elements.textArea.value.split('\n');
          const variableNames = lines.map((line) => toCamelCase(line));
          elements.variableNameContainer.textContent = variableNames.join('\n');
        };

        const initialize = () => {
          elements.autoVariableName.onchange = () => {
            const variableNameGroup = document.querySelector('.variable-name');
            if (!elements.autoVariableName.checked) {
              variableNameGroup.classList.add('hidden');
            } else {
              variableNameGroup.classList.remove('hidden');
              updateVariableNames();
            }
          };

          elements.textArea.addEventListener('input', updateVariableNames);
        };

        return {
          updateVariableNames,
          initialize,
        };
      };

      // ===== Delimiter 관련 기능 =====
      const createDelimiterController = () => {
        let delimiterSetsData = [];
        let isExpanded = false;

        const createDelimiterSetElement = (set, index) => {
          const setElement = document.createElement('div');
          setElement.className = 'delimiter-set';
          setElement.innerHTML = `
            <div class="delimiter-inputs">
              <input type="text" class="delimiter-input" placeholder="Opening" value="${
                set.opening
              }" />
              <input type="text" class="delimiter-input" placeholder="Closing" value="${
                set.closing
              }" />
              <span style="display:flex;align-items:center;gap:0.25rem;">
                <span class="shortcut-modifier" style="font-size:0.75rem;">${modifierLabel}</span>
                <span style="font-size:0.75rem;">+</span>
                <input type="text" class="shortcut-input" maxlength="1" placeholder="E" value="${
                  set.shortcutKey || ''
                }" style="width:2.5em;text-align:center;" />
              </span>
            </div>
            <div class="delimiter-actions">
              <button class="delimiter-button delete" title="Delete">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <path
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    fill="none"
                  />
                </svg>
              </button>
            </div>
          `;

          attachDelimiterSetEventListeners(setElement, set, index);
          return setElement;
        };

        const attachDelimiterSetEventListeners = (setElement, set, index) => {
          const [openingInput, closingInput] = setElement.querySelectorAll('.delimiter-input');
          const shortcutInput = setElement.querySelector('.shortcut-input');
          const deleteButton = setElement.querySelector('.delete');

          openingInput.addEventListener('change', () => {
            delimiterSetsData[index].opening = openingInput.value;
            saveDelimiterSets();
            updateDelimiterButtons();
          });

          closingInput.addEventListener('change', () => {
            delimiterSetsData[index].closing = closingInput.value;
            saveDelimiterSets();
            updateDelimiterButtons();
          });

          shortcutInput.addEventListener('focus', () => {
            shortcutInput.value = '';
          });

          shortcutInput.addEventListener('keydown', (event) => {
            // Tab 키는 기본 동작 유지
            if (event.key === 'Tab') {
              return;
            }

            event.preventDefault();
            const key = event.code.replace('Key', '');
            if (/^[A-Z]$/.test(key)) {
              shortcutInput.value = key;
              delimiterSetsData[index].shortcutKey = key;
              delimiterSetsData[index].shortcut = `${modifierLabel} + ${key}`;
              saveDelimiterSets();
              updateDelimiterButtons();
            } else {
              shortcutInput.value = '';
              delimiterSetsData[index].shortcutKey = '';
              delimiterSetsData[index].shortcut = '';
              saveDelimiterSets();
              updateDelimiterButtons();
            }
          });

          deleteButton.addEventListener('click', () => {
            delimiterSetsData.splice(index, 1);
            saveDelimiterSets();
            renderDelimiterSets();
            updateDelimiterButtons();
          });
        };

        const insertDelimiters = (set) => {
          const start = elements.textArea.selectionStart;
          const end = elements.textArea.selectionEnd;
          const text = elements.textArea.value;
          const selectedText = text.substring(start, end);

          if (selectedText) {
            elements.textArea.value =
              text.substring(0, start) +
              set.opening +
              selectedText +
              set.closing +
              text.substring(end);
            elements.textArea.selectionStart = start + set.opening.length;
            elements.textArea.selectionEnd = end + set.opening.length;
          } else {
            elements.textArea.value =
              text.substring(0, start) + set.opening + set.closing + text.substring(end);
            elements.textArea.selectionStart = start + set.opening.length;
            elements.textArea.selectionEnd = start + set.opening.length;
          }

          elements.textArea.focus();
          variableNameGenerator.updateVariableNames();
        };

        const saveDelimiterSets = () => {
          parent.postMessage(
            {
              pluginMessage: {
                type: 'save-delimiter-sets',
                sets: delimiterSetsData,
              },
            },
            '*',
          );
        };

        const renderDelimiterSets = () => {
          elements.delimiterSets.innerHTML = '';
          delimiterSetsData.forEach((set, index) => {
            elements.delimiterSets.appendChild(createDelimiterSetElement(set, index));
          });
          elements.addDelimiterButton.disabled =
            delimiterSetsData.length >= DELIMITER_SET_MAX_COUNT;
        };

        const updateDelimiterButtons = () => {
          elements.delimiterButtons.innerHTML = '';
          let hasButtons = false;

          delimiterSetsData.forEach((set) => {
            if (set.opening || set.closing) {
              hasButtons = true;
              const button = document.createElement('button');
              button.className = 'button';
              button.textContent = `${set.opening}...${set.closing}`;
              button.title = set.shortcutKey
                ? `Shortcut: ${modifierLabel} + ${set.shortcutKey}`
                : '';
              button.addEventListener('click', () => {
                insertDelimiters(set);
              });
              elements.delimiterButtons.appendChild(button);
            }
          });

          elements.delimiterButtons.style.display = hasButtons ? 'flex' : 'none';
        };

        const toggleDelimiterSection = () => {
          isExpanded = elements.delimiterContent.classList.toggle('expanded');
          elements.delimiterHeader.classList.toggle('expanded', isExpanded);
        };

        const initialize = () => {
          // 기본적으로 닫혀있는 상태로 초기화
          elements.delimiterContent.classList.remove('expanded');
          elements.delimiterHeader.classList.remove('expanded');

          elements.delimiterHeader.addEventListener('click', (e) => {
            // Add Set 버튼이 클릭된 경우는 제외
            if (!e.target.closest('#addDelimiterButton')) {
              toggleDelimiterSection();
            }
          });

          elements.addDelimiterButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (delimiterSetsData.length < DELIMITER_SET_MAX_COUNT) {
              delimiterSetsData.push({
                opening: '',
                closing: '',
                shortcutKey: '',
              });
              renderDelimiterSets();
              // 새 구분자를 추가할 때 자동으로 섹션 열기
              if (!isExpanded) {
                toggleDelimiterSection();
              }
            }
          });

          document.addEventListener('keydown', (event) => {
            const modifier = isMac ? event.metaKey : event.ctrlKey;
            if (modifier) {
              const key = event.code.replace('Key', '');
              if (/^[A-Z]$/.test(key)) {
                const set = delimiterSetsData.find((set) => set.shortcutKey === key);
                const isFocusedOnTextArea = document.activeElement === elements.textArea;
                if (set && isFocusedOnTextArea) {
                  event.preventDefault();
                  insertDelimiters(set);
                }
              }
            }
          });
        };

        const setData = (data) => {
          delimiterSetsData = data;
          renderDelimiterSets();
          updateDelimiterButtons();
        };

        return {
          initialize,
          setData,
          renderDelimiterSets,
          updateDelimiterButtons,
        };
      };

      // ===== UI 유틸리티 =====
      const createUIService = () => {
        const showToast = (message) => {
          elements.toast.textContent = message;
          elements.toast.classList.add('show');
          setTimeout(() => {
            elements.toast.classList.remove('show');
          }, 1500);
        };

        const initializeCopyButtons = () => {
          document.querySelectorAll('.copy-button').forEach((button) => {
            button.addEventListener('click', () => {
              const targetId = button.getAttribute('data-target');
              const target = document.getElementById(targetId);

              if (target.tagName === 'TEXTAREA') {
                target.select();
                document.execCommand('copy');
              } else {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = target.textContent;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);
              }

              showToast(
                `${targetId === 'variableNameContainer' ? 'Variable Name' : 'Text'} copied!`,
              );
            });
          });
        };

        return {
          showToast,
          initializeCopyButtons,
        };
      };

      // ===== 인스턴스 생성 =====
      const variableNameGenerator = createVariableNameGenerator();
      const delimiterController = createDelimiterController();
      const uiService = createUIService();

      // ===== 메시지 핸들러 =====
      onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (msg.type === 'extract-texts') {
          const rows = msg.texts;
          elements.textArea.value = rows.map(({ text }) => text).join('\n');
          variableNameGenerator.updateVariableNames();
        } else if (msg.type === 'load-delimiter-sets') {
          delimiterController.setData(msg.sets);
        }
      };

      // ===== 초기화 =====
      elements.shortcutKey.textContent = `${modifierLabel} + key`;
      variableNameGenerator.initialize();
      delimiterController.initialize();
      uiService.initializeCopyButtons();
    </script>
  </body>
</html>
